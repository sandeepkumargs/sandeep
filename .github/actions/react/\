name: SSH Deploy Action

inputs:
  ssh-private-key:
    description: '/home/sandeep/oac-sandeep/goac-sandeep.pem'
    required: true
  server-address:
    description: 'ec2-13-232-52-59.ap-south-1.compute.amazonaws.com'
    required: true
  remote-directory:
    description: '/var/www/html'
    required: true
  local-directory:
    description: '~/sandeep11/sandeep/my-app/build'
    required: true

runs:
  using: 'composite'
  steps:
    - name: SSH deploy step 1
      run: |
        ssh -v -i /home/sandeep/goac-sandeep/goac-sandeep.pem ubuntu@ec2-13-232-52-59.ap-south-1.compute.amazonaws.com 'echo "Deleting existing files in remote directory..." && sudo rm -rf /var/www/html/*'
        ssh -i /home/sandeep/goac-sandeep/goac-sandeep.pem ubuntu@ec2-13-232-52-59.ap-south-1.compute.amazonaws.com 'echo "Deploying files to server..."'
        rsync -avz --delete "${{ inputs.local-directory }}"/* -e "ssh -i /home/sandeep/goac-sandeep/goac-sandeep.pem" ubuntu@ec2-13-232-52-59.ap-south-1.compute.amazonaws.com:/var/www/html/
      shell: bash
    - name: SSH deploy step 2
      run: |
        ssh -i ${{ inputs.ssh-private-key }} ${{ inputs.server-address }} 'echo "Deployment completed."'
      shell: bash

